@page "/LanguageRegion"
@model LanguageRegionModel
@{
    ViewData["Title"] = "Language & Region";
    ViewData["ActivePage"] = "LanguageRegion";
}

<link href="~/css/manage-pages.css" rel="stylesheet" />

<style>
    .preview-card {
        background: linear-gradient(135deg, rgba(102, 126, 234, 0.05), rgba(118, 75, 162, 0.05));
        border: 2px solid var(--gray-200);
        border-radius: var(--border-radius-lg);
        padding: 1.5rem;
        margin-top: 1.5rem;
    }

    .preview-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 1.25rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--gray-200);
    }

    .preview-header-title {
        font-size: 1rem;
        font-weight: 600;
        color: var(--gray-900);
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .preview-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1.5rem;
    }

    .preview-item {
        background: white;
        padding: 1.25rem;
        border-radius: var(--border-radius-md);
        border: 1px solid var(--gray-200);
        transition: all var(--transition-base);
    }

    .preview-item:hover {
        border-color: var(--primary-color);
        box-shadow: var(--shadow-md);
    }

    .preview-label {
        font-size: 0.75rem;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: var(--gray-500);
        font-weight: 600;
        margin-bottom: 0.5rem;
        display: flex;
        align-items: center;
        gap: 0.375rem;
    }

    .preview-value {
        font-size: 1rem;
        font-weight: 600;
        color: var(--gray-900);
        word-break: break-word;
    }

    .locale-select-wrapper {
        position: relative;
    }

    .locale-select-icon {
        position: absolute;
        left: 1rem;
        top: 50%;
        transform: translateY(-50%);
        color: var(--gray-400);
        pointer-events: none;
        z-index: 1;
    }

    .form-select-with-icon {
        padding-left: 3rem;
    }

    .info-badge {
        display: inline-flex;
        align-items: center;
        gap: 0.375rem;
        padding: 0.375rem 0.75rem;
        background: var(--info-light);
        color: var(--info-color);
        border-radius: var(--border-radius-sm);
        font-size: 0.8125rem;
        font-weight: 500;
    }
</style>

<!-- Page Header -->
<div class="page-header">
        <div>
            <h1>Language & Region</h1>
            <p>Customize your language, region, currency, and time zone preferences</p>
        </div>
    </div>

    <!-- Validation Errors -->
    @if (!ViewData.ModelState.IsValid)
    {
        <div class="alert alert-danger">
            <strong>‚ö†Ô∏è Please fix the errors below</strong>
        </div>
    }

    <!-- Main Settings Card -->
    <div class="card">
        <div class="card-header">
            <div>
                <h2 class="card-title">Regional Settings</h2>
                <p class="card-subtitle">Choose your preferred locale for language, formatting, and currency display</p>
            </div>
        </div>
        <div class="card-body">
            <form method="post" class="needs-validation" novalidate>
                @Html.AntiForgeryToken()

                <!-- Locale Selection -->
                <div class="form-group">
                    <label class="form-label" for="Input_Culture">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 0.25rem;">
                            <path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8zm7.5-6.923c-.67.204-1.335.82-1.887 1.855A7.97 7.97 0 0 0 5.145 4H7.5V1.077zM4.09 4a9.267 9.267 0 0 1 .64-1.539 6.7 6.7 0 0 1 .597-.933A7.025 7.025 0 0 0 2.255 4H4.09zm-.582 3.5c.03-.877.138-1.718.312-2.5H1.674a6.958 6.958 0 0 0-.656 2.5h2.49zM4.847 5a12.5 12.5 0 0 0-.338 2.5H7.5V5H4.847zM8.5 5v2.5h2.99a12.495 12.495 0 0 0-.337-2.5H8.5zM4.51 8.5a12.5 12.5 0 0 0 .337 2.5H7.5V8.5H4.51zm3.99 0V11h2.653c.187-.765.306-1.608.338-2.5H8.5zM5.145 12c.138.386.295.744.468 1.068.552 1.035 1.218 1.65 1.887 1.855V12H5.145zm.182 2.472a6.696 6.696 0 0 1-.597-.933A9.268 9.268 0 0 1 4.09 12H2.255a7.024 7.024 0 0 0 3.072 2.472zM3.82 11a13.652 13.652 0 0 1-.312-2.5h-2.49c.062.89.291 1.733.656 2.5H3.82zm6.853 3.472A7.024 7.024 0 0 0 13.745 12H11.91a9.27 9.27 0 0 1-.64 1.539 6.688 6.688 0 0 1-.597.933zM8.5 12v2.923c.67-.204 1.335-.82 1.887-1.855.173-.324.33-.682.468-1.068H8.5zm3.68-1h2.146c.365-.767.594-1.61.656-2.5h-2.49a13.65 13.65 0 0 1-.312 2.5zm2.802-3.5a6.959 6.959 0 0 0-.656-2.5H12.18c.174.782.282 1.623.312 2.5h2.49zM11.27 2.461c.247.464.462.98.64 1.539h1.835a7.024 7.024 0 0 0-3.072-2.472c.218.284.418.598.597.933zM10.855 4a7.966 7.966 0 0 0-.468-1.068C9.835 1.897 9.17 1.282 8.5 1.077V4h2.355z"/>
                        </svg>
                        Locale
                    </label>
                    <div class="locale-select-wrapper">
                        <span class="locale-select-icon">üåç</span>
                        <select asp-for="Input.Culture" class="form-control form-select form-select-with-icon" id="Input_Culture">
                            @foreach (var opt in Model.LocaleOptions)
                            {
                                <option value="@opt.Culture"
                                        data-country="@opt.Country"
                                        data-currency="@opt.Currency">
                                    @opt.Display
                                </option>
                            }
                        </select>
                    </div>
                    <span class="form-error" asp-validation-for="Input.Culture"></span>
                    <span class="form-help">
                        <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16" style="margin-right: 0.25rem;">
                            <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
                            <path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.07.352.176.288.469l-.738 3.468c-.194.897.105 1.319.808 1.319.545 0 1.178-.252 1.465-.598l.088-.416c-.2.176-.492.246-.686.246-.275 0-.375-.193-.304-.533L8.93 6.588zM9 4.5a1 1 0 1 1-2 0 1 1 0 0 1 2 0z"/>
                        </svg>
                        Your selection will determine the language, date format, number format, and currency symbol throughout the application
                    </span>
                </div>

                <!-- Hidden fields -->
                <input type="hidden" asp-for="Input.Country" id="Input_Country" />
                <input type="hidden" asp-for="Input.TimeZoneId" id="Input_TimeZoneId" />

                <!-- Preview Card -->
                <div class="preview-card">
                    <div class="preview-header">
                        <div class="preview-header-title">
                            <svg width="18" height="18" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M1.5 1a.5.5 0 0 0-.5.5v3a.5.5 0 0 1-1 0v-3A1.5 1.5 0 0 1 1.5 0h3a.5.5 0 0 1 0 1h-3zM11 .5a.5.5 0 0 1 .5-.5h3A1.5 1.5 0 0 1 16 1.5v3a.5.5 0 0 1-1 0v-3a.5.5 0 0 0-.5-.5h-3a.5.5 0 0 1-.5-.5zM.5 11a.5.5 0 0 1 .5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 1 0 1h-3A1.5 1.5 0 0 1 0 14.5v-3a.5.5 0 0 1 .5-.5zm15 0a.5.5 0 0 1 .5.5v3a1.5 1.5 0 0 1-1.5 1.5h-3a.5.5 0 0 1 0-1h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 1 .5-.5z"/>
                                <path d="M3 14s-1 0-1-1 1-4 6-4 6 3 6 4-1 1-1 1H3zm8-9a3 3 0 1 1-6 0 3 3 0 0 1 6 0z"/>
                            </svg>
                            Live Preview
                        </div>
                        <span class="info-badge">
                            <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>
                            </svg>
                            Updates automatically
                        </span>
                    </div>

                    <div class="preview-grid">
                        <div class="preview-item">
                            <div class="preview-label">
                                <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
                                </svg>
                                Date & Time
                            </div>
                            <div id="previewDate" class="preview-value">‚Äî</div>
                        </div>

                        <div class="preview-item">
                            <div class="preview-label">
                                <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M2.866 14.85c-.078.444.36.791.746.593l4.39-2.256 4.389 2.256c.386.198.824-.149.746-.592l-.83-4.73 3.522-3.356c.33-.314.16-.888-.282-.95l-4.898-.696L8.465.792a.513.513 0 0 0-.927 0L5.354 5.12l-4.898.696c-.441.062-.612.636-.283.95l3.523 3.356-.83 4.73zm4.905-2.767-3.686 1.894.694-3.957a.565.565 0 0 0-.163-.505L1.71 6.745l4.052-.576a.525.525 0 0 0 .393-.288L8 2.223l1.847 3.658a.525.525 0 0 0 .393.288l4.052.575-2.906 2.77a.565.565 0 0 0-.163.506l.694 3.957-3.686-1.894a.503.503 0 0 0-.461 0z"/>
                                </svg>
                                Number Format
                            </div>
                            <div id="previewNumber" class="preview-value">‚Äî</div>
                        </div>

                        <div class="preview-item">
                            <div class="preview-label">
                                <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M4 10.781c.148 1.667 1.513 2.85 3.591 3.003V15h1.043v-1.216c2.27-.179 3.678-1.438 3.678-3.3 0-1.59-.947-2.51-2.956-3.028l-.722-.187V3.467c1.122.11 1.879.714 2.07 1.616h1.47c-.166-1.6-1.54-2.748-3.54-2.875V1H7.591v1.233c-1.939.23-3.27 1.472-3.27 3.156 0 1.454.966 2.483 2.661 2.917l.61.162v4.031c-1.149-.17-1.94-.8-2.131-1.718H4zm3.391-3.836c-1.043-.263-1.6-.825-1.6-1.616 0-.944.704-1.641 1.8-1.828v3.495l-.2-.05zm1.591 1.872c1.287.323 1.852.859 1.852 1.769 0 1.097-.826 1.828-2.2 1.939V8.73l.348.086z"/>
                                </svg>
                                Currency
                            </div>
                            <div id="previewCurrency" class="preview-value">‚Äî</div>
                        </div>

                        <div class="preview-item">
                            <div class="preview-label">
                                <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
                                    <path d="M8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
                                    <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm7-8A7 7 0 1 1 1 8a7 7 0 0 1 14 0z"/>
                                </svg>
                                Time Zone
                            </div>
                            <div id="previewTz" class="preview-value">‚Äî</div>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="card-footer">
                    <a asp-page="./Index" class="btn btn-secondary">Cancel</a>
                    <button type="submit" class="btn btn-primary">
                        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
                            <path d="M2 1a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1H9.5a1 1 0 0 0-1 1v7.293l2.646-2.647a.5.5 0 0 1 .708.708l-3.5 3.5a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L7.5 9.293V2a2 2 0 0 1 2-2H14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2a2 2 0 0 1 2-2h2.5a.5.5 0 0 1 0 1H2z"/>
                        </svg>
                        Save Changes
                    </button>
                </div>
            </form>
        </div>
    </div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        (function () {
            const sel = document.getElementById("Input_Culture");
            const hidCountry = document.getElementById("Input_Country");
            const hidTz = document.getElementById("Input_TimeZoneId");

            const elDate = document.getElementById("previewDate");
            const elNum  = document.getElementById("previewNumber");
            const elCur  = document.getElementById("previewCurrency");
            const elTz   = document.getElementById("previewTz");

            // Capture browser time zone (IANA)
            const browserTz = Intl.DateTimeFormat().resolvedOptions().timeZone;
            if (hidTz) hidTz.value = browserTz;

            function currencyFromOption(opt) {
                return opt?.dataset?.currency || "USD";
            }
            function countryFromOption(opt) {
                return opt?.dataset?.country || "US";
            }

            function updatePreview() {
                const opt = sel.options[sel.selectedIndex];
                const locale = sel.value || navigator.language;
                const currency = currencyFromOption(opt);
                const country  = countryFromOption(opt);
                if (hidCountry) hidCountry.value = country;

                const now = new Date();

                try {
                    elDate.textContent = new Intl.DateTimeFormat(locale, {
                        dateStyle: "full", timeStyle: "long", timeZone: browserTz
                    }).format(now);
                } catch { elDate.textContent = now.toString(); }

                try {
                    elNum.textContent = new Intl.NumberFormat(locale, { maximumFractionDigits: 2 })
                        .format(1234567.89);
                } catch { elNum.textContent = "1,234,567.89"; }

                try {
                    elCur.textContent = new Intl.NumberFormat(locale, {
                        style: "currency",
                        currency: currency,
                        currencyDisplay: "symbol"
                    }).format(1999.99);
                } catch (e) {
                    console.warn("Currency preview error:", e);
                    elCur.textContent = new Intl.NumberFormat("en-US", { style: "currency", currency: "USD" })
                        .format(1999.99);
                }

                try {
                    elTz.textContent = new Intl.DateTimeFormat(locale, { timeStyle: "long", timeZone: browserTz })
                        .format(now) + " (" + browserTz + ")";
                } catch { elTz.textContent = browserTz; }
            }

            sel.addEventListener("change", updatePreview);
            updatePreview();
        })();
    </script>
}
